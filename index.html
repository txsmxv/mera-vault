<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Drive Vault</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #f8fafc; }
        .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.4); }
        .nav-active { background: #2563eb !important; color: white !important; box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.4); }
    </style>
</head>
<body class="text-slate-900">

    <!-- Screen: Loader -->
    <div id="loader" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center">
        <div class="w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4"></div>
        <p class="text-slate-500 font-medium italic">Vault Initialize Ho Raha Hai...</p>
    </div>

    <!-- Screen: Login -->
    <div id="auth-screen" class="fixed inset-0 bg-white z-50 flex items-center justify-center hidden">
        <div class="max-w-sm w-full p-8 text-center">
            <div class="w-20 h-20 bg-blue-600 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-2xl">
                <span class="text-white text-4xl font-bold">V</span>
            </div>
            <h1 class="text-3xl font-bold mb-2">Drive Vault</h1>
            <p class="text-slate-500 mb-8 text-sm">Authorized for: txsmxv.github.io</p>
            <button id="login-btn" class="w-full flex items-center justify-center gap-3 bg-white border border-slate-300 py-4 rounded-2xl font-semibold hover:bg-slate-50 transition-all active:scale-95 shadow-sm">
                <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" class="w-6 h-6" alt="G">
                Continue with Google
            </button>
        </div>
    </div>

    <!-- Screen: Dashboard -->
    <div id="dashboard" class="hidden min-h-screen flex flex-col lg:flex-row">
        <aside class="w-full lg:w-64 bg-white border-r p-6 flex flex-col">
            <div class="font-bold text-xl text-blue-600 px-2 mb-10">Mera Vault</div>
            <nav class="space-y-2 flex-1">
                <button onclick="switchTab('pass')" id="nav-pass" class="w-full text-left p-4 rounded-xl font-semibold nav-active">ðŸ”‘ Passwords</button>
                <button onclick="switchTab('work')" id="nav-work" class="w-full text-left p-4 rounded-xl font-semibold text-slate-500 hover:bg-slate-50">ðŸ“‚ Backup Files</button>
            </nav>
            <button onclick="logout()" class="mt-auto p-4 text-red-500 font-semibold hover:bg-red-50 rounded-xl transition">ðŸšª Logout</button>
        </aside>

        <main class="flex-1 p-8 lg:p-16 overflow-y-auto">
            <header class="flex justify-between items-center mb-10">
                <h2 id="tab-title" class="text-3xl font-bold text-slate-800">Password Manager</h2>
                <div id="status-tag" class="text-xs bg-slate-100 px-3 py-1 rounded-full text-slate-500">Cloud Connected</div>
            </header>

            <div id="tab-pass" class="space-y-8">
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input id="site-name" type="text" placeholder="Service (e.g. Facebook)" class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-100 bg-slate-50">
                        <input id="site-pass" type="text" placeholder="Password" class="w-full p-4 border rounded-2xl outline-none focus:ring-2 focus:ring-blue-100 bg-slate-50">
                    </div>
                    <button onclick="saveVaultData()" id="save-btn" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg hover:bg-blue-700 transition flex items-center justify-center gap-2">
                        <span id="btn-text">ðŸ’¾ Save to My Google Drive</span>
                    </button>
                </div>
                
                <div class="flex justify-between items-center">
                    <h3 class="font-bold text-slate-500 uppercase text-xs tracking-widest">Saved Passwords</h3>
                    <button onclick="fetchVaultData()" class="text-blue-600 text-xs font-bold hover:underline">Sync Now</button>
                </div>

                <div id="vault-list" class="space-y-3">
                    <!-- Data will load here -->
                    <div class="p-12 text-center text-slate-400 bg-white border-2 border-dashed rounded-3xl">
                        Loading your cloud data...
                    </div>
                </div>
            </div>

            <div id="tab-work" class="hidden">
                <div class="bg-white p-20 rounded-3xl border-2 border-dashed text-center">
                    <p class="text-slate-500">Full file backup integration active.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        const CLIENT_ID = '149481857090-4hnrd5dlqvpmo0356r49tatc8ga5dr9b.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyAma2jL01xe3HbxrSaNN3WtiFRA57wRfQA';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';
        const FILENAME = 'vault_data.json';

        let accessToken = null;
        let tokenClient;
        let gapiInited = false;
        let gisInited = false;
        let savedPasswords = [];

        // Initialize
        async function initGapi() {
            await gapi.client.init({ apiKey: API_KEY, discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"] });
            gapiInited = true;
            maybeReady();
        }
        function gapiLoaded() { gapi.load('client', initGapi); }

        function gisLoaded() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: (resp) => {
                    if (resp.error) return;
                    accessToken = resp.access_token;
                    showDashboard();
                },
            });
            gisInited = true;
            maybeReady();
        }

        function maybeReady() {
            if (gapiInited && gisInited) {
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('auth-screen').classList.remove('hidden');
            }
        }

        function showDashboard() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            fetchVaultData();
        }

        document.getElementById('login-btn').onclick = () => tokenClient.requestAccessToken({prompt: 'consent'});

        // Drive Logic: Fetch Data
        async function fetchVaultData() {
            try {
                const response = await gapi.client.drive.files.list({
                    q: `name = '${FILENAME}' and trashed = false`,
                    fields: 'files(id, name)',
                });
                const files = response.result.files;
                if (files && files.length > 0) {
                    const fileId = files[0].id;
                    const res = await fetch(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`, {
                        headers: { 'Authorization': `Bearer ${accessToken}` }
                    });
                    savedPasswords = await res.json();
                    renderList();
                } else {
                    document.getElementById('vault-list').innerHTML = '<div class="p-8 text-center text-slate-400 bg-white border rounded-3xl">No data found in your Drive. Save something!</div>';
                }
            } catch (e) { console.error(e); }
        }

        // Drive Logic: Save Data
        async function saveVaultData() {
            const name = document.getElementById('site-name').value;
            const pass = document.getElementById('site-pass').value;
            if(!name || !pass) return alert("Bharein!");

            const btn = document.getElementById('btn-text');
            btn.innerText = "Syncing...";
            
            const newData = [...savedPasswords, { id: Date.now(), name, pass, date: new Date().toLocaleDateString() }];
            
            try {
                const response = await gapi.client.drive.files.list({ q: `name = '${FILENAME}' and trashed = false` });
                const files = response.result.files;
                const metadata = { name: FILENAME, mimeType: 'application/json' };
                const blob = new Blob([JSON.stringify(newData)], { type: 'application/json' });

                if (files && files.length > 0) {
                    // Update existing
                    await fetch(`https://www.googleapis.com/upload/drive/v3/files/${files[0].id}?uploadType=media`, {
                        method: 'PATCH',
                        headers: { 'Authorization': `Bearer ${accessToken}` },
                        body: blob
                    });
                } else {
                    // Create new
                    const form = new FormData();
                    form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                    form.append('file', blob);
                    await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${accessToken}` },
                        body: form
                    });
                }
                
                savedPasswords = newData;
                renderList();
                document.getElementById('site-name').value = '';
                document.getElementById('site-pass').value = '';
                btn.innerText = "ðŸ’¾ Save to My Google Drive";
            } catch (e) { alert("Error saving data!"); btn.innerText = "Save to My Google Drive"; }
        }

        function renderList() {
            const container = document.getElementById('vault-list');
            container.innerHTML = savedPasswords.map(item => `
                <div class="bg-white p-4 rounded-2xl border flex justify-between items-center shadow-sm">
                    <div>
                        <div class="font-bold text-slate-800">${item.name}</div>
                        <div class="text-xs text-slate-400 font-mono">${item.pass}</div>
                    </div>
                    <div class="text-[10px] text-slate-300">${item.date}</div>
                </div>
            `).join('');
        }

        function switchTab(tab) {
            document.getElementById('tab-pass').classList.toggle('hidden', tab !== 'pass');
            document.getElementById('tab-work').classList.toggle('hidden', tab !== 'work');
            document.getElementById('nav-pass').className = tab === 'pass' ? 'w-full text-left p-4 rounded-xl font-semibold nav-active' : 'w-full text-left p-4 rounded-xl font-semibold text-slate-500 hover:bg-slate-50';
            document.getElementById('nav-work').className = tab === 'work' ? 'w-full text-left p-4 rounded-xl font-semibold nav-active' : 'w-full text-left p-4 rounded-xl font-semibold text-slate-500 hover:bg-slate-50';
        }

        function logout() { location.reload(); }
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>
